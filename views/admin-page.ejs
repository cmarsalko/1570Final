<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pitt Study Admin Dashboard</title>
  <link rel="stylesheet" href="/admin-page.css">
</head>
<body>

<div class="dashboard-container">

  <aside class="sidebar">
    <h2 class="sidebar-title">Panther Planner - Admin</h2>
    <ul class="sidebar-links">
      <li><a class="logout" href="/dashboard">Back to Site</a></li>
    </ul>
  </aside>

  <main class="content">

    <header class="top-bar">
      <h1>Admin – Study Session Dashboard</h1>
      <div class="user-info">
        Signed in as Admin:
        <%= currentUser && currentUser.name ? currentUser.name : 'Admin' %>
      </div>
    </header>

        <!-- ACTIVE SESSIONS -->
    <section class="session-section">
      <h2>Active Study Sessions</h2>

      <% if (activeSessions && activeSessions.length > 0) { %>
        <% activeSessions.forEach(function (session) { %>
          <div class="session-card">
            <h3><%= session.subject %></h3>
            <p><strong>Time:</strong> <%= session.dateFormatted %> <%= session.startTime %> – <%= session.endTime %></p>
            <p><strong>Location:</strong> <%= session.building %> – <%= session.room %></p>
            <p><strong>Hosted By:</strong> <%= session.hostedBy %></p>

            <div class="admin-actions">
              <form method="POST" action="/admin/sessions/<%= session._id %>/close">
                <button type="submit" class="btn-close">Close Session</button>
              </form>
              <form method="POST" action="/admin/sessions/<%= session._id %>/delete" onsubmit="return confirm('Delete this session?');">
                <button type="submit" class="danger btn-delete">Delete</button>
              </form>
            </div>
          </div>
        <% }); %>
      <% } else { %>
        <p>No active sessions.</p>
      <% } %>
    </section>

    <!-- CLOSED SESSIONS -->
    <section class="session-section closed">
      <h2>Closed Study Sessions</h2>

      <% if (closedSessions && closedSessions.length > 0) { %>
        <% closedSessions.forEach(function (session) { %>
          <div class="session-card">
            <h3><%= session.subject %></h3>
            <p><strong>Time:</strong> <%= session.dateFormatted %> <%= session.startTime %> – <%= session.endTime %></p>
            <p><strong>Location:</strong> <%= session.building %> – <%= session.room %></p>
            <p><strong>Hosted By:</strong> <%= session.hostedBy %></p>

            <div class="admin-actions">
              <form method="POST" action="/admin/sessions/<%= session._id %>/reopen">
                <button type="submit" class="btn-reopen">Reopen</button>
              </form>
              <form method="POST" action="/admin/sessions/<%= session._id %>/delete" onsubmit="return confirm('Delete this session?');">
                <button type="submit" class="danger btn-delete">Delete</button>
              </form>
            </div>
          </div>
        <% }); %>
      <% } else { %>
        <p>No closed sessions.</p>
      <% } %>
    </section>

    <!-- USER MANAGEMENT -->
    <div class="manage-users-section">
      <h3>Manage Users</h3>

      <table class="users-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach(user => { %>
            <tr>
              <td><%= user.name %></td>
              <td><%= user.email %></td>
              <td>
                <span class="role-badge <%= user.role === 'admin' ? 'admin' : '' %>">
                  <%= user.role %>
                </span>
              </td>
              <td>
                <div class="user-actions">
                  <form action="/admin/users/<%= user._id %>/toggle-role" method="POST">
                    <button class="user-action-btn user-action-btn--primary" type="submit">
                      <%= user.role === 'admin' ? 'Make Student' : 'Make Admin' %>
                    </button>
                  </form>

                  <form action="/admin/users/<%= user._id %>/delete" method="POST">
                    <button class="user-action-btn user-action-btn--danger" type="submit">
                      Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <!-- QUICK ADMIN STATS (STATIC PREVIEW) -->
    <section class="session-section">
      <h2>Admin Overview</h2>
      <div class="session-card">
        <p><strong>Total Users:</strong> <%= stats && stats.userCount ? stats.userCount : 128 %></p>
        <p><strong>Active Sessions:</strong> <%= stats && stats.activeSessionCount ? stats.activeSessionCount : 5 %></p>
        <p><strong>Closed Sessions Today:</strong> <%= stats && stats.closedTodayCount ? stats.closedTodayCount : 3 %></p>
      </div>
    </section>

  </main>

</div>

<script src="/admin-page.js"></script>
</body>
</html>